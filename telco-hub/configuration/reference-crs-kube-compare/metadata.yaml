---
apiVersion: v2
parts:
  - name: version-check
    description: |-
      A mismatch here means you may be using the wrong reference.
      This reference was designed for OpenShift 4.18.
    components:
      - name: version-check
        allOf:
          - path: ReferenceVersionCheck.yaml
            config:
              ignore-unspecified-fields: true
              fieldsToOmitRefs:
                - allowStatusCheck
  - name: optional-storage
    description: |-
      TODO: Link to Hub RDS storage section when published
    components:
      - name: local-storage-operator
        allOrNoneOf:
          - path: optional/lso/lsoNS.yaml
          - path: optional/lso/lsoOperatorGroup.yaml
          - path: optional/lso/lsoSubscription.yaml
          - path: optional/lso/lsoLocalVolume.yaml
      - name: odf-internal-operator
        allOrNoneOf:
          - path: optional/odf-internal/odfNS.yaml
          - path: optional/odf-internal/odfOperatorGroup.yaml
          - path: optional/odf-internal/odfSubscription.yaml
          - path: optional/odf-internal/storageCluster.yaml
            config:
              ignore-unspecified-fields: true
  - name: required-talm
    description: |-
      TODO: Link to Hub RDS TALM section when published
    components:
      - name: talm-operator
        allOf:
          - path: required/talm/talmSubscription.yaml
  - name: required-acm
    description: |-
      TODO: Link to Hub RDS ACM section when published
    components:
      - name: acm-operator
        allOf:
          - path: required/acm/acmNS.yaml
          - path: required/acm/acmOperGroup.yaml
          - path: required/acm/acmSubscription.yaml
          - path: required/acm/acmMCH.yaml
            config:
              ignore-unspecified-fields: true
          - path: required/acm/acmProvisioning.yaml
            config:
              ignore-unspecified-fields: true
          - path: required/acm/acmMirrorRegistryCM.yaml
          - path: required/acm/acmAgentServiceConfig.yaml
  - name: optional-logging
    description: |-
      TODO: Link to Hub RDS logging section when published
    components:
      - name: cluster-logging-operator
        allOrNoneOf:
          - path: optional/logging/clusterLogNS.yaml
          - path: optional/logging/clusterLogOperGroup.yaml
          - path: optional/logging/clusterLogSubscription.yaml

templateFunctionFiles:
  - version_match.tmpl

fieldsToOmit:
  defaultOmitRef: all
  items:
    defaults:
      - pathToKey: metadata.annotations."kubectl.kubernetes.io/last-applied-configuration"
      - pathToKey: metadata.annotations."openshift.io/sa.scc.uid-range"
      - pathToKey: metadata.annotations."openshift.io/sa.scc.mcs"
      - pathToKey: metadata.annotations."openshift.io/sa.scc.supplemental-groups"
      - pathToKey: metadata.annotations."olm.providedAPIs"
      - pathToKey: metadata.annotations."argocd.argoproj.io"
        isPrefix: true
      - pathToKey: metadata.annotations."workload.openshift.io/allowed"
      - pathToKey: metadata.labels."kubernetes.io/metadata.name"
      - pathToKey: metadata.labels."security.openshift.io/scc.podSecurityLabelSync"
      - pathToKey: metadata.labels."operators.coreos.com/local-storage-operator.openshift-local-storage"
      - pathToKey: metadata.labels."operators.coreos.com/odf-operator.openshift-storage"
      - pathToKey: metadata.labels."operators.coreos.com/topology-aware-lifecycle-manager.openshift-operators"
      - pathToKey: metadata.labels."operators.coreos.com/advanced-cluster-management.open-cluster-management"
      - pathToKey: metadata.labels."agent-install.openshift.io/watch"
      - pathToKey: metadata.labels."cluster.open-cluster-management.io/backup"
      - pathToKey: metadata.labels."pod-security.kubernetes.io"
        isPrefix: true
      - pathToKey: metadata.labels."olm.operatorgroup.uid"
        isPrefix: true
      - pathToKey: metadata.labels."app.kubernetes.io/instance"
      - pathToKey: metadata.creationTimestamp
      - pathToKey: metadata.finalizers
      - pathToKey: metadata.generation
      - pathToKey: metadata.resourceVersion
      - pathToKey: metadata.uid
      - pathToKey: metadata.ownerReferences
      - pathToKey: spec.finalizers
    allowStatusCheck:
      - include: defatuls
    all:
      - include: defaults
      - pathToKey: status
